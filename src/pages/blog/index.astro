---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const [featured, ...rest] = posts;
---

<BaseLayout title="文章" description="博客文章归档">
	<section class="head">
		<h1>文章</h1>
		<p class="sub">按时间排列。想找特定内容可以去 <a href="/search">搜索</a>。</p>
	</section>

	{featured && (
		<section class="featured">
			<a class="featured__card" href={`/blog/${featured.slug}/`}>
				<div class="featured__meta">
					<span class="stamp">Featured</span>
					<span class="date"><FormattedDate date={featured.data.pubDate} /></span>
				</div>
				<h2 class="featured__title">{featured.data.title}</h2>
				<p class="featured__desc">{featured.data.description}</p>
				{featured.data.heroImage && (
					<div class="featured__img">
						<Image width={1200} height={600} src={featured.data.heroImage} alt="" />
					</div>
				)}
			</a>
		</section>
	)}

	<section class="grid">
		{rest.map((post) => (
			<a class="card" href={`/blog/${post.slug}/`}>
				<div class="card__top">
					<span class="card__date"><FormattedDate date={post.data.pubDate} /></span>
					{(post.data.tags?.length ?? 0) > 0 && (
						<span class="card__tags">{post.data.tags.slice(0, 2).join(' · ')}</span>
					)}
				</div>
				<div class="card__title">{post.data.title}</div>
				<div class="card__desc">{post.data.description}</div>
			</a>
		))}
	</section>

	<style>
		.head {
			margin-top: 0.6rem;
			display: flex;
			align-items: baseline;
			justify-content: space-between;
			gap: 1rem;
			flex-wrap: wrap;
		}
		.sub {
			margin: 0;
			color: rgba(var(--muted), 1);
			max-width: 52ch;
		}

		.featured {
			margin-top: 1rem;
		}
		.featured__card {
			background-image: none;
			display: block;
			border-radius: var(--radius-lg);
			border: 1px solid rgba(16, 18, 22, 0.14);
			background: rgba(255, 255, 255, 0.75);
			box-shadow: var(--shadow);
			padding: 1.2rem 1.2rem 1.25rem;
			position: relative;
			overflow: hidden;
		}
		.featured__card::before {
			content: "";
			position: absolute;
			inset: -1px;
			background:
				radial-gradient(900px 300px at 10% 0%, rgba(31, 75, 255, 0.16), transparent 55%),
				radial-gradient(700px 300px at 90% 10%, rgba(255, 61, 46, 0.09), transparent 55%);
			pointer-events: none;
		}
		.featured__meta {
			position: relative;
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 0.75rem;
			flex-wrap: wrap;
			color: rgba(var(--muted), 1);
			font-size: 0.95rem;
		}
		.stamp {
			display: inline-flex;
			align-items: center;
			padding: 0.22rem 0.65rem;
			border-radius: 999px;
			border: 1px solid rgba(31, 75, 255, 0.25);
			background: rgba(31, 75, 255, 0.07);
			letter-spacing: 0.12em;
			text-transform: uppercase;
			font-size: 0.75rem;
			color: rgba(var(--ink), 0.92);
		}
		.featured__title {
			position: relative;
			margin-top: 0.75rem;
		}
		.featured__desc {
			position: relative;
			margin: 0.5rem 0 0;
			color: rgba(var(--ink), 0.86);
			max-width: 80ch;
		}
		.featured__img {
			position: relative;
			margin-top: 0.95rem;
		}

		.grid {
			margin-top: 1rem;
			display: grid;
			grid-template-columns: repeat(2, minmax(0, 1fr));
			gap: 0.9rem;
		}
		.card {
			background-image: none;
			border-radius: var(--radius-lg);
			border: 1px solid rgba(16, 18, 22, 0.12);
			background: rgba(255, 255, 255, 0.68);
			padding: 0.95rem 1rem 1rem;
			box-shadow: 0 18px 40px rgba(16, 18, 22, 0.08);
			transition: transform 140ms ease, border 140ms ease, box-shadow 140ms ease;
		}
		.card:hover {
			transform: translateY(-2px);
			border-color: rgba(31, 75, 255, 0.22);
			box-shadow: 0 24px 60px rgba(16, 18, 22, 0.12);
		}
		.card__top {
			display: flex;
			gap: 0.8rem;
			align-items: baseline;
			justify-content: space-between;
			flex-wrap: wrap;
			color: rgba(var(--muted), 1);
			font-size: 0.92rem;
		}
		.card__title {
			margin-top: 0.55rem;
			font-weight: 950;
			letter-spacing: -0.02em;
			font-size: 1.15rem;
			color: rgba(var(--ink), 0.98);
		}
		.card__desc {
			margin-top: 0.35rem;
			color: rgba(var(--ink), 0.86);
			font-size: 0.98rem;
		}

		@media (max-width: 880px) {
			.grid { grid-template-columns: 1fr; }
		}
	</style>
</BaseLayout>
