---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog'))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 6);

const allTags = new Map<string, number>();
for (const p of await getCollection('blog')) {
	for (const t of p.data.tags ?? []) allTags.set(t, (allTags.get(t) ?? 0) + 1);
}
const topTags = [...allTags.entries()]
	.sort((a, b) => b[1] - a[1])
	.slice(0, 10)
	.map(([tag]) => tag);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<section class="hero">
		<div class="hero__badge">简约 · 轻量 · 纯静态</div>
		<h1 class="hero__title">{SITE_TITLE}</h1>
		<p class="hero__desc">{SITE_DESCRIPTION}</p>
		<div class="hero__actions">
			<a class="btn" href="/blog">阅读文章</a>
			<a class="btn btn--ghost" href="/search">搜索</a>
			<a class="btn btn--ghost" href="/rss.xml">RSS</a>
		</div>
	</section>

	<section class="grid">
		<div class="card">
			<h2>最新文章</h2>
			{posts.length === 0 ? (
				<p style="opacity:0.75">还没有文章。你可以在 <code>src/content/blog/</code> 新建 Markdown 文件。</p>
			) : (
				<ul class="postlist">
					{posts.map((post) => (
						<li class="postitem">
							<div class="postitem__row">
								<a class="postitem__title" href={`/blog/${post.slug}/`}>{post.data.title}</a>
								<span class="postitem__date"><FormattedDate date={post.data.pubDate} /></span>
							</div>
							<div class="postitem__desc">{post.data.description}</div>
							{(post.data.tags?.length ?? 0) > 0 && (
								<div class="chips">
									{post.data.tags.slice(0, 4).map((t) => (
										<a class="chip" href={`/tags/${encodeURIComponent(t)}`}>{t}</a>
									))}
								</div>
							)}
						</li>
					))}
				</ul>
			)}
			<div class="card__footer">
				<a href="/blog">查看全部 →</a>
			</div>
		</div>

		<div class="card">
			<h2>快速入口</h2>
			<ul class="quick">
				<li><a href="/tags">标签</a>：按主题浏览</li>
				<li><a href="/search">搜索</a>：标题/摘要/标签全文检索</li>
				<li><a href="/about">关于</a>：个人简介与联系方式</li>
			</ul>

			{topTags.length > 0 && (
				<>
					<h3 style="margin-top:1.2rem">热门标签</h3>
					<div class="chips">
						{topTags.map((t) => (
							<a class="chip" href={`/tags/${encodeURIComponent(t)}`}>{t}</a>
						))}
					</div>
				</>
			)}
		</div>
	</section>

	<style>
		.hero {
			padding: 1.25rem 1.25rem 1.5rem;
			border: 1px solid rgba(var(--black), 8%);
			border-radius: 16px;
			background: rgba(255, 255, 255, 0.75);
			box-shadow: 0 12px 30px rgba(var(--gray), 18%);
			backdrop-filter: blur(8px);
		}
		.hero__badge {
			display: inline-block;
			font-size: 0.8rem;
			padding: 0.25rem 0.6rem;
			border-radius: 999px;
			background: rgba(var(--gray-light), 60%);
			color: rgb(var(--gray-dark));
		}
		.hero__title { margin-top: 0.9rem; font-size: 2.2rem; }
		.hero__desc { margin: 0.6rem 0 0; opacity: 0.85; }
		.hero__actions { margin-top: 1rem; display: flex; gap: 0.6rem; flex-wrap: wrap; }
		.btn {
			display: inline-flex;
			align-items: center;
			gap: 0.4rem;
			padding: 0.55rem 0.9rem;
			border-radius: 10px;
			border: 1px solid rgba(var(--black), 10%);
			text-decoration: none;
			font-size: 0.95rem;
			background: var(--accent);
			color: white;
		}
		.btn:hover { opacity: 0.95; }
		.btn--ghost {
			background: transparent;
			color: rgb(var(--black));
		}
		.grid {
			display: grid;
			grid-template-columns: 1.6fr 1fr;
			gap: 1rem;
			margin-top: 1rem;
		}
		.card {
			padding: 1.1rem 1.1rem 0.8rem;
			border: 1px solid rgba(var(--black), 8%);
			border-radius: 16px;
			background: rgba(255, 255, 255, 0.9);
		}
		.card h2 { font-size: 1.25rem; margin-bottom: 0.8rem; }
		.card__footer { margin-top: 0.8rem; opacity: 0.85; }
		.postlist { list-style: none; padding: 0; margin: 0; }
		.postitem { padding: 0.75rem 0; border-top: 1px solid rgba(var(--black), 6%); }
		.postitem:first-child { border-top: none; padding-top: 0; }
		.postitem__row { display: flex; align-items: baseline; justify-content: space-between; gap: 0.75rem; }
		.postitem__title { text-decoration: none; color: rgb(var(--black)); font-weight: 700; }
		.postitem__title:hover { color: var(--accent); }
		.postitem__date { font-size: 0.85rem; opacity: 0.75; white-space: nowrap; }
		.postitem__desc { margin-top: 0.25rem; opacity: 0.82; font-size: 0.95rem; }
		.quick { margin: 0; padding-left: 1.1rem; }
		.chips { margin-top: 0.55rem; display: flex; flex-wrap: wrap; gap: 0.4rem; }
		.chip {
			display: inline-block;
			padding: 0.18rem 0.55rem;
			border-radius: 999px;
			border: 1px solid rgba(var(--black), 10%);
			text-decoration: none;
			font-size: 0.82rem;
			color: rgb(var(--gray-dark));
			background: rgba(var(--gray-light), 45%);
		}
		.chip:hover { background: rgba(var(--gray-light), 70%); }

		@media (max-width: 860px) {
			.grid { grid-template-columns: 1fr; }
			.hero__title { font-size: 1.9rem; }
		}
	</style>
</BaseLayout>
