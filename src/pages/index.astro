---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog'))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 6);

const allTags = new Map<string, number>();
for (const p of await getCollection('blog')) {
	for (const t of p.data.tags ?? []) allTags.set(t, (allTags.get(t) ?? 0) + 1);
}
const topTags = [...allTags.entries()]
	.sort((a, b) => b[1] - a[1])
	.slice(0, 10)
	.map(([tag]) => tag);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<section class="hero">
		<div class="hero__badge">简约 · 轻量 · 纯静态</div>
		<h1 class="hero__title">{SITE_TITLE}</h1>
		<p class="hero__desc">{SITE_DESCRIPTION}</p>
		<p class="hero__meta">每周更新 · 中文写作 · 支持 RSS · 站内搜索</p>
		<div class="hero__actions">
			<a class="btn" href="/blog">阅读文章</a>
			<a class="btn btn--ghost" href="/search">搜索</a>
			<a class="btn btn--ghost" href="/tags">标签</a>
			<a class="btn btn--ghost" href="/rss.xml">RSS</a>
		</div>
	</section>

	<section class="grid">
		<div class="card">
			<h2>最新文章</h2>
			{posts.length === 0 ? (
				<p style="opacity:0.75">还没有文章。你可以在 <code>src/content/blog/</code> 新建 Markdown 文件。</p>
			) : (
				<ul class="postlist">
					{posts.map((post) => (
						<li class="postitem">
							<div class="postitem__row">
								<a class="postitem__title" href={`/blog/${post.slug}/`}>{post.data.title}</a>
								<span class="postitem__date"><FormattedDate date={post.data.pubDate} /></span>
							</div>
							<div class="postitem__desc">{post.data.description}</div>
							{(post.data.tags?.length ?? 0) > 0 && (
								<div class="chips">
									{post.data.tags.slice(0, 4).map((t) => (
										<a class="chip" href={`/tags/${encodeURIComponent(t)}`}>{t}</a>
									))}
								</div>
							)}
						</li>
					))}
				</ul>
			)}
			<div class="card__footer">
				<a href="/blog">查看全部 →</a>
			</div>
		</div>

		<div class="card">
			<h2>快速入口</h2>
			<ul class="quick">
				<li><a href="/tags">标签</a>：按主题浏览</li>
				<li><a href="/search">搜索</a>：标题/摘要/标签全文检索</li>
				<li><a href="/about">关于</a>：个人简介与联系方式</li>
			</ul>

			{topTags.length > 0 && (
				<>
					<h3 style="margin-top:1.2rem">热门标签</h3>
					<div class="chips">
						{topTags.map((t) => (
							<a class="chip" href={`/tags/${encodeURIComponent(t)}`}>{t}</a>
						))}
					</div>
				</>
			)}
		</div>
	</section>

	<style>
		.hero {
			position: relative;
			padding: 1.35rem 1.35rem 1.6rem;
			border: 1px solid rgba(var(--ink), 10%);
			border-radius: 18px;
			background: rgba(255, 255, 255, 0.78);
			box-shadow: var(--box-shadow);
			backdrop-filter: blur(10px);
			overflow: hidden;
		}
		.hero::before {
			content: '';
			position: absolute;
			inset: -2px;
			background:
				radial-gradient(600px 180px at 15% 0%, rgba(209, 47, 47, 0.18), transparent 60%),
				radial-gradient(600px 220px at 85% 20%, rgba(16, 18, 20, 0.10), transparent 55%);
			pointer-events: none;
		}
		.hero::after {
			content: '';
			position: absolute;
			inset: 0;
			background-image:
				repeating-linear-gradient(
					135deg,
					rgba(var(--ink), 0.04) 0px,
					rgba(var(--ink), 0.04) 1px,
					transparent 1px,
					transparent 10px
				);
			opacity: 0.35;
			mix-blend-mode: multiply;
			pointer-events: none;
			mask-image: radial-gradient(200px 120px at 40% 20%, black 0%, transparent 75%);
		}
		.hero__badge {
			position: relative;
			display: inline-flex;
			align-items: center;
			gap: 0.55rem;
			font-size: 0.78rem;
			letter-spacing: 0.08em;
			text-transform: uppercase;
			padding: 0.28rem 0.7rem;
			border-radius: 999px;
			border: 1px solid rgba(var(--ink), 16%);
			background: rgba(var(--paper), 90%);
			color: rgba(var(--ink), 0.86);
		}
		.hero__badge::before {
			content: '';
			width: 10px;
			height: 10px;
			border-radius: 999px;
			background: var(--accent);
			box-shadow: 0 0 0 4px rgba(209, 47, 47, 0.15);
		}
		.hero__title {
			position: relative;
			margin-top: 0.95rem;
			font-size: 2.35rem;
			letter-spacing: -0.02em;
			line-height: 1.05;
		}
		.hero__desc {
			position: relative;
			margin: 0.7rem 0 0;
			max-width: 48ch;
			opacity: 0.88;
		}
		.hero__meta {
			position: relative;
			margin: 0.6rem 0 0;
			font-size: 0.92rem;
			opacity: 0.75;
		}
		.hero__actions {
			position: relative;
			margin-top: 1.1rem;
			display: flex;
			gap: 0.65rem;
			flex-wrap: wrap;
		}
		.btn {
			display: inline-flex;
			align-items: center;
			gap: 0.4rem;
			padding: 0.55rem 0.95rem;
			border-radius: 12px;
			border: 1px solid rgba(var(--ink), 14%);
			text-decoration: none;
			font-size: 0.95rem;
			background: rgba(var(--ink), 0.92);
			color: rgba(var(--paper), 0.98);
			transition: transform 140ms ease, box-shadow 140ms ease, background 140ms ease;
			box-shadow: 0 10px 18px rgba(0, 0, 0, 0.10);
		}
		.btn:hover {
			transform: translateY(-1px);
			box-shadow: 0 14px 26px rgba(0, 0, 0, 0.14);
		}
		.btn--ghost {
			background: rgba(255, 255, 255, 0.75);
			color: rgb(var(--ink));
			box-shadow: none;
		}
		.btn--ghost:hover { background: rgba(255, 255, 255, 0.95); }

		.grid {
			display: grid;
			grid-template-columns: 1.7fr 1fr;
			gap: 1rem;
			margin-top: 1rem;
		}
		.card {
			padding: 1.15rem 1.15rem 0.9rem;
			border: 1px solid rgba(var(--ink), 10%);
			border-radius: 18px;
			background: rgba(255, 255, 255, 0.86);
			box-shadow: 0 10px 22px rgba(0, 0, 0, 0.06);
		}
		.card h2 { font-size: 1.18rem; margin-bottom: 0.8rem; letter-spacing: -0.01em; }
		.card__footer { margin-top: 0.85rem; opacity: 0.85; }

		.postlist { list-style: none; padding: 0; margin: 0; }
		.postitem { padding: 0.78rem 0; border-top: 1px solid rgba(var(--ink), 8%); }
		.postitem:first-child { border-top: none; padding-top: 0; }
		.postitem__row { display: flex; align-items: baseline; justify-content: space-between; gap: 0.75rem; }
		.postitem__title {
			text-decoration: none;
			color: rgb(var(--ink));
			font-weight: 800;
			letter-spacing: -0.01em;
		}
		.postitem__title:hover { color: var(--accent); }
		.postitem__date {
			font-size: 0.85rem;
			opacity: 0.72;
			white-space: nowrap;
			font-variant-numeric: tabular-nums;
		}
		.postitem__desc { margin-top: 0.25rem; opacity: 0.82; font-size: 0.95rem; }
		.quick { margin: 0; padding-left: 1.1rem; }

		.chips { margin-top: 0.6rem; display: flex; flex-wrap: wrap; gap: 0.4rem; }
		.chip {
			display: inline-block;
			padding: 0.2rem 0.6rem;
			border-radius: 999px;
			border: 1px solid rgba(var(--ink), 14%);
			text-decoration: none;
			font-size: 0.82rem;
			color: rgba(var(--ink), 0.86);
			background: rgba(var(--paper), 80%);
			transition: transform 120ms ease, background 120ms ease;
		}
		.chip:hover {
			transform: translateY(-1px);
			background: rgba(var(--paper), 100%);
		}

		@media (max-width: 860px) {
			.grid { grid-template-columns: 1fr; }
			.hero__title { font-size: 2.0rem; }
		}
	</style>
</BaseLayout>
