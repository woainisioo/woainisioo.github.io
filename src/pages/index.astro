---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog'))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 5);

const allTags = new Map<string, number>();
for (const p of await getCollection('blog')) {
	for (const t of p.data.tags ?? []) allTags.set(t, (allTags.get(t) ?? 0) + 1);
}
const topTags = [...allTags.entries()]
	.sort((a, b) => b[1] - a[1])
	.slice(0, 12)
	.map(([tag]) => tag);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<section class="hero">
		<div class="hero__frame">
			<div class="hero__kicker">
				<span class="pill">PAPER ATELIER</span>
				<span class="rule" aria-hidden="true"></span>
				<span class="kicker__meta">notes · builds · reflections</span>
			</div>
			<h1 class="hero__title">{SITE_TITLE}</h1>
			<p class="hero__desc">{SITE_DESCRIPTION}</p>
			<div class="hero__actions">
				<a class="btn" href="/blog">阅读文章</a>
				<a class="btn btn--ghost" href="/search">搜索</a>
				<a class="btn btn--ghost" href="/rss.xml">RSS</a>
			</div>
		</div>

		<aside class="hero__aside">
			<div class="aside__card">
				<div class="aside__title">快捷入口</div>
				<div class="aside__grid">
					<a class="tile" href="/tags">
						<span class="tile__t">标签</span>
						<span class="tile__d">按主题浏览</span>
					</a>
					<a class="tile" href="/about">
						<span class="tile__t">关于</span>
						<span class="tile__d">简介与联系方式</span>
					</a>
					<a class="tile" href="/blog">
						<span class="tile__t">归档</span>
						<span class="tile__d">所有文章列表</span>
					</a>
					<a class="tile" href="/search">
						<span class="tile__t">搜索</span>
						<span class="tile__d">标题/摘要/标签</span>
					</a>
				</div>
				{topTags.length > 0 && (
					<div class="chips">
						{topTags.map((t) => (
							<a class="chip" href={`/tags/${encodeURIComponent(t)}`}>{t}</a>
						))}
					</div>
				)}
			</div>
		</aside>
	</section>

	<section class="section">
		<div class="section__head">
			<h2>最新文章</h2>
			<a class="section__more" href="/blog">查看全部 →</a>
		</div>
		<ul class="postlist">
			{posts.map((post, i) => (
				<li class="post" style={`--d:${i * 80}ms`}>
					<a class="post__title" href={`/blog/${post.slug}/`}>{post.data.title}</a>
					<div class="post__meta">
						<span class="date"><FormattedDate date={post.data.pubDate} /></span>
						{(post.data.tags?.length ?? 0) > 0 && (
							<span class="tags">{post.data.tags.slice(0, 3).join(' · ')}</span>
						)}
					</div>
					<div class="post__desc">{post.data.description}</div>
				</li>
			))}
		</ul>
	</section>

	<style>
		.hero {
			margin-top: 0.8rem;
			display: grid;
			grid-template-columns: 1.55fr 1fr;
			gap: 1rem;
			align-items: stretch;
		}
		.hero__frame {
			position: relative;
			border-radius: var(--radius-lg);
			background: rgba(255, 255, 255, 0.75);
			border: 1px solid rgba(16, 18, 22, 0.14);
			box-shadow: var(--shadow);
			padding: 1.35rem 1.35rem 1.55rem;
			overflow: hidden;
		}
		.hero__frame::before {
			content: "";
			position: absolute;
			inset: -1px;
			background:
				radial-gradient(900px 340px at 14% 0%, rgba(31, 75, 255, 0.14), transparent 55%),
				radial-gradient(700px 300px at 90% 10%, rgba(255, 61, 46, 0.08), transparent 55%);
			pointer-events: none;
		}
		.hero__kicker {
			position: relative;
			display: flex;
			align-items: center;
			gap: 0.75rem;
			flex-wrap: wrap;
			color: rgba(var(--muted), 1);
		}
		.pill {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.28rem 0.7rem;
			border-radius: 999px;
			border: 1px solid rgba(31, 75, 255, 0.25);
			background: rgba(31, 75, 255, 0.07);
			font-size: 0.78rem;
			letter-spacing: 0.14em;
			text-transform: uppercase;
			color: rgba(var(--ink), 0.9);
		}
		.rule {
			flex: 1;
			height: 1px;
			min-width: 120px;
			background: linear-gradient(90deg, rgba(16, 18, 22, 0.25), transparent);
			opacity: 0.8;
		}
		.kicker__meta {
			font-size: 0.9rem;
			opacity: 0.85;
			letter-spacing: 0.02em;
		}
		.hero__title {
			position: relative;
			margin-top: 0.95rem;
			line-height: 1.02;
		}
		.hero__desc {
			position: relative;
			margin: 0.8rem 0 0;
			max-width: 60ch;
			color: rgba(var(--ink), 0.88);
		}
		.hero__actions {
			position: relative;
			margin-top: 1.15rem;
			display: flex;
			gap: 0.65rem;
			flex-wrap: wrap;
		}
		.btn {
			background-image: none;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			padding: 0.62rem 0.95rem;
			border-radius: 999px;
			border: 1px solid rgba(16, 18, 22, 0.16);
			font-weight: 800;
			letter-spacing: -0.01em;
			color: white;
			background: linear-gradient(180deg, rgba(31, 75, 255, 1), rgba(10, 29, 122, 1));
			box-shadow: 0 18px 34px rgba(31, 75, 255, 0.18);
			transition: transform 140ms ease, filter 140ms ease;
		}
		.btn:hover { transform: translateY(-1px); filter: brightness(1.02); }
		.btn--ghost {
			color: rgba(var(--ink), 0.94);
			background: rgba(255, 255, 255, 0.75);
			border-color: rgba(16, 18, 22, 0.16);
			box-shadow: none;
		}

		.hero__aside { height: 100%; }
		.aside__card {
			border-radius: var(--radius-lg);
			background: rgba(255, 255, 255, 0.70);
			border: 1px solid rgba(16, 18, 22, 0.14);
			box-shadow: 0 18px 40px rgba(16, 18, 22, 0.10);
			padding: 1.1rem;
			height: 100%;
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			gap: 1rem;
		}
		.aside__title {
			font-weight: 900;
			letter-spacing: -0.01em;
		}
		.aside__grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 0.65rem;
		}
		.tile {
			background-image: none;
			padding: 0.75rem 0.8rem;
			border-radius: 16px;
			border: 1px solid rgba(16, 18, 22, 0.12);
			background: rgba(246, 243, 236, 0.78);
			transition: transform 140ms ease, box-shadow 140ms ease, border 140ms ease;
		}
		.tile:hover {
			transform: translateY(-1px);
			border-color: rgba(31, 75, 255, 0.22);
			box-shadow: 0 18px 45px rgba(16, 18, 22, 0.10);
		}
		.tile__t { display: block; font-weight: 900; letter-spacing: -0.01em; }
		.tile__d { display: block; margin-top: 0.2rem; color: rgba(var(--muted), 1); font-size: 0.92rem; }

		.chips {
			display: flex;
			flex-wrap: wrap;
			gap: 0.45rem;
		}
		.chip {
			background-image: none;
			padding: 0.22rem 0.65rem;
			border-radius: 999px;
			border: 1px solid rgba(16, 18, 22, 0.12);
			background: rgba(255, 255, 255, 0.70);
			color: rgba(var(--muted), 1);
			font-size: 0.82rem;
			transition: transform 140ms ease, background 140ms ease;
		}
		.chip:hover { transform: translateY(-1px); background: rgba(31, 75, 255, 0.08); }

		.section {
			margin-top: 1.1rem;
			border-radius: var(--radius-lg);
			padding: 1.15rem 1.15rem 0.4rem;
			border: 1px solid rgba(16, 18, 22, 0.12);
			background: rgba(255, 255, 255, 0.58);
			box-shadow: 0 18px 40px rgba(16, 18, 22, 0.08);
		}
		.section__head {
			display: flex;
			align-items: baseline;
			justify-content: space-between;
			gap: 1rem;
			flex-wrap: wrap;
			margin-bottom: 0.6rem;
		}
		.section__more { background-image: none; color: rgba(var(--muted), 1); }
		.section__more:hover { color: rgba(31, 75, 255, 1); }

		.postlist { list-style: none; padding: 0; margin: 0; }
		.post {
			padding: 0.95rem 0;
			border-top: 1px dashed rgba(16, 18, 22, 0.16);
			animation: rise 520ms cubic-bezier(.2,.8,.2,1) both;
			animation-delay: var(--d, 0ms);
		}
		.post:first-child { border-top: none; }
		.post__title {
			background-image: none;
			display: inline-block;
			font-weight: 950;
			letter-spacing: -0.02em;
		}
		.post__title:hover { color: rgba(31, 75, 255, 1); }
		.post__meta {
			margin-top: 0.25rem;
			color: rgba(var(--muted), 1);
			font-size: 0.92rem;
			display: flex;
			gap: 0.8rem;
			flex-wrap: wrap;
		}
		.post__desc {
			margin-top: 0.35rem;
			color: rgba(var(--ink), 0.86);
			max-width: 84ch;
		}

		@keyframes rise {
			from { opacity: 0; transform: translateY(10px); }
			to { opacity: 1; transform: translateY(0); }
		}

		@media (max-width: 920px) {
			.hero { grid-template-columns: 1fr; }
			.aside__grid { grid-template-columns: 1fr 1fr; }
		}
		@media (max-width: 520px) {
			.aside__grid { grid-template-columns: 1fr; }
		}
	</style>
</BaseLayout>
