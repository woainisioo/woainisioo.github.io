---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	const tags = new Set<string>();
	for (const p of posts) {
		for (const t of p.data.tags ?? []) tags.add(t);
	}
	return [...tags].map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;
const posts = (await getCollection('blog'))
	.filter((p) => (p.data.tags ?? []).includes(tag))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title={`标签：${tag}`}>
	<h1>标签：{tag}</h1>
	<p><a href="/tags">← 返回标签列表</a></p>
	<ul>
		{posts.map((post) => (
			<li>
				<a href={`/blog/${post.slug}/`}>{post.data.title}</a>
				<span style="opacity:0.7">
					 — {post.data.pubDate.toLocaleDateString('zh-CN')}
				</span>
			</li>
		))}
	</ul>
</BaseLayout>
